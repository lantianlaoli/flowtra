# TikTok åŠŸèƒ½é›†æˆè¿›åº¦æ–‡æ¡£

æœ¬æ–‡æ¡£è®°å½• Flowtra åº”ç”¨ä¸ TikTok å¹³å°çš„å®Œæ•´é›†æˆè¿›åº¦ï¼ŒåŒ…æ‹¬å·²å®ŒæˆåŠŸèƒ½ã€å½“å‰ä»»åŠ¡å’Œæœªæ¥è§„åˆ’ã€‚

---

## ğŸ“‹ ç›®å½•

1. [é›†æˆæ¦‚è¿°](#é›†æˆæ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [Phase 1: è´¦å·ç»‘å®šï¼ˆå·²å®Œæˆï¼‰](#phase-1-è´¦å·ç»‘å®šå·²å®Œæˆ)
4. [Phase 2: å†…å®¹å‘å¸ƒï¼ˆè¿›è¡Œä¸­ï¼‰](#phase-2-å†…å®¹å‘å¸ƒè¿›è¡Œä¸­)
5. [Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆè§„åˆ’ä¸­ï¼‰](#phase-3-é«˜çº§åŠŸèƒ½è§„åˆ’ä¸­)
6. [åŠŸèƒ½æ¸…å•](#åŠŸèƒ½æ¸…å•)
7. [å·²çŸ¥é—®é¢˜](#å·²çŸ¥é—®é¢˜)
8. [ä¸‹ä¸€æ­¥è®¡åˆ’](#ä¸‹ä¸€æ­¥è®¡åˆ’)

---

## é›†æˆæ¦‚è¿°

### é¡¹ç›®ç›®æ ‡

å°† Flowtra çš„ AI è§†é¢‘ç”Ÿæˆèƒ½åŠ›ä¸ TikTok å¹³å°æ·±åº¦é›†æˆï¼Œå®ç°ä¸€é”®å‘å¸ƒå·¥ä½œæµï¼š

```
ç”Ÿæˆ AI è§†é¢‘ â†’ ä¸€é”®å‘å¸ƒåˆ° TikTok â†’ è¿½è¸ªå‘å¸ƒçŠ¶æ€ â†’ åˆ†ææ•°æ®
```

### é›†æˆèŒƒå›´

- **ç”¨æˆ·ç®¡ç†ï¼š** TikTok è´¦å·ç»‘å®š/è§£ç»‘
- **å†…å®¹å‘å¸ƒï¼š** è§†é¢‘ç›´æ¥å‘å¸ƒåˆ° TikTok
- **çŠ¶æ€è¿½è¸ªï¼š** å®æ—¶ç›‘æ§å‘å¸ƒè¿›åº¦
- **æ•°æ®åˆ†æï¼š**ï¼ˆæœªæ¥ï¼‰è§†é¢‘è¡¨ç°æ•°æ®åŒæ­¥

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| **å‰ç«¯æ¡†æ¶** | Next.js App Router | 15.4.4 |
| **UI åº“** | TailwindCSS, Framer Motion | - |
| **åç«¯** | Next.js API Routes | 15.4.4 |
| **æ•°æ®åº“** | Supabase (PostgreSQL) | - |
| **æ–‡ä»¶å­˜å‚¨** | Supabase Storage | - |
| **è®¤è¯** | Clerk | - |
| **TikTok API** | TikTok API v2 | v2 |
| **è¯­è¨€** | TypeScript | 5.x |

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flowtra Application                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   User Interface â”‚         â”‚   Clerk Auth     â”‚          â”‚
â”‚  â”‚  (Next.js Pages) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (User Session)  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                                                   â”‚
â”‚           â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          Next.js API Routes                   â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚  - /api/tiktok/auth/*                        â”‚           â”‚
â”‚  â”‚  - /api/tiktok/user/info                     â”‚           â”‚
â”‚  â”‚  - /api/tiktok/unbind                        â”‚           â”‚
â”‚  â”‚  - /api/tiktok/publish/init      [Phase 2]  â”‚           â”‚
â”‚  â”‚  - /api/tiktok/publish/status    [Phase 2]  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                â”‚                                              â”‚
â”‚                â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         Supabase Database                     â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚  - user_tiktok_connections                   â”‚           â”‚
â”‚  â”‚  - tiktok_publish_history        [Phase 2]  â”‚           â”‚
â”‚  â”‚  - standard_ads_projects                     â”‚           â”‚
â”‚  â”‚  - character_ads_projects                    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       TikTok Platform                  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  - OAuth 2.0 Authorization            â”‚
        â”‚  - Login Kit API                      â”‚
        â”‚  - Display API                        â”‚
        â”‚  - Content Posting API    [Phase 2]  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: è´¦å·ç»‘å®šï¼ˆå·²å®Œæˆï¼‰

### å®æ–½æ—¶é—´
**2025-01-28** âœ… å·²å®Œæˆ

### åŠŸèƒ½æè¿°

å®ç° TikTok Login Kit OAuth 2.0 æˆæƒæµç¨‹ï¼Œå…è®¸ç”¨æˆ·ç»‘å®š TikTok è´¦å·ã€‚

### å·²å®ŒæˆåŠŸèƒ½

#### 1. OAuth æˆæƒæµç¨‹ âœ…

**å®ç°æ–‡ä»¶ï¼š**
- `app/api/tiktok/auth/authorize/route.ts`
- `app/api/tiktok/auth/callback/route.ts`

**åŠŸèƒ½ç‚¹ï¼š**
- âœ… ç”Ÿæˆ CSRF state token é˜²æ­¢æ”»å‡»
- âœ… é‡å®šå‘åˆ° TikTok æˆæƒé¡µé¢
- âœ… å¤„ç†æˆæƒå›è°ƒ
- âœ… äº¤æ¢ authorization code è·å– access_token
- âœ… è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆopen_id, display_name, avatar_urlï¼‰
- âœ… Token åŠ å¯†å­˜å‚¨ï¼ˆAES-256-CBCï¼‰

**è¯·æ±‚çš„ Scopes:**
- `user.info.basic` - åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
- `video.publish` - è§†é¢‘å‘å¸ƒæƒé™

#### 2. æ•°æ®åº“è®¾è®¡ âœ…

**è¡¨ï¼š** `user_tiktok_connections`

```sql
CREATE TABLE user_tiktok_connections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR NOT NULL,                    -- Clerk user ID
  tiktok_open_id VARCHAR NOT NULL UNIQUE,      -- TikTok user ID
  tiktok_union_id VARCHAR,                     -- Cross-app ID
  display_name VARCHAR NOT NULL,               -- TikTok display name
  avatar_url TEXT,                             -- Profile picture URL
  access_token TEXT NOT NULL,                  -- Encrypted access token
  refresh_token TEXT NOT NULL,                 -- Encrypted refresh token
  token_expires_at TIMESTAMPTZ NOT NULL,       -- Token expiry timestamp
  scope TEXT NOT NULL,                         -- Granted scopes
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

**Row Level Security (RLS):** å·²å¯ç”¨ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è¿æ¥

#### 3. ç”¨æˆ·ç®¡ç† UI âœ…

**å®ç°æ–‡ä»¶ï¼š**
- `components/pages/CreditsPage.tsx`ï¼ˆ/dashboard/accountï¼‰

**åŠŸèƒ½ç‚¹ï¼š**
- âœ… "Connected Accounts" åŒºåŸŸ
- âœ… TikTok å¡ç‰‡æ˜¾ç¤ºï¼ˆlogo, çŠ¶æ€, ç”¨æˆ·ä¿¡æ¯ï¼‰
- âœ… æœªç»‘å®šçŠ¶æ€ï¼šæ˜¾ç¤º "Connect TikTok" æŒ‰é’®
- âœ… å·²ç»‘å®šçŠ¶æ€ï¼šæ˜¾ç¤ºç”¨æˆ·åã€å¤´åƒã€"Disconnect" æŒ‰é’®
- âœ… å®æ—¶çŠ¶æ€åˆ·æ–°

#### 4. API ç«¯ç‚¹ âœ…

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/tiktok/auth/authorize` | GET | å‘èµ· OAuth æˆæƒ | âœ… |
| `/api/tiktok/auth/callback` | GET | å¤„ç†æˆæƒå›è°ƒ | âœ… |
| `/api/tiktok/user/info` | GET | è·å–ç»‘å®šçŠ¶æ€ | âœ… |
| `/api/tiktok/unbind` | POST | è§£ç»‘è´¦å· | âœ… |

#### 5. å®‰å…¨æªæ–½ âœ…

- âœ… CSRF Protectionï¼ˆstate tokenï¼‰
- âœ… Token åŠ å¯†å­˜å‚¨ï¼ˆAES-256-CBCï¼‰
- âœ… HttpOnly cookies
- âœ… HTTPS å¼ºåˆ¶ï¼ˆsecure: true, sameSite: 'none'ï¼‰
- âœ… Clerk middleware å…¬å¼€è·¯ç”±é…ç½®

#### 6. å·²ä¿®å¤é—®é¢˜ âœ…

**é—®é¢˜ 1ï¼š** Clerk middleware æ‹¦æˆª callback
- **è§£å†³æ–¹æ¡ˆï¼š** å°† `/api/tiktok/auth/callback` æ·»åŠ åˆ°å…¬å¼€è·¯ç”±

**é—®é¢˜ 2ï¼š** Cookie è·¨åŸŸé—®é¢˜ï¼ˆCSRF state mismatchï¼‰
- **è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨ `sameSite: 'none'` å’Œ `secure: true`

### ç›¸å…³æ–‡æ¡£

- âœ… `docs/tiktok/login-kit-guide.md` - å®Œæ•´çš„ Login Kit æŠ€æœ¯æ–‡æ¡£
- âœ… GitHub Commit: `68a16bb`, `f9675f7`

---

## Phase 2: å†…å®¹å‘å¸ƒï¼ˆè¿›è¡Œä¸­ï¼‰

### å®æ–½æ—¶é—´
**2025-01-28** ğŸ”„ è¿›è¡Œä¸­

### åŠŸèƒ½æè¿°

å…è®¸ç”¨æˆ·å°† Flowtra ç”Ÿæˆçš„è§†é¢‘ç›´æ¥å‘å¸ƒåˆ° TikTok å¹³å°ã€‚

### å®æ–½è®¡åˆ’

#### 1. åç«¯ API å¼€å‘ ğŸ”„

**ä»»åŠ¡ 1ï¼š** åˆ›å»ºåˆå§‹åŒ–å‘å¸ƒ API

**æ–‡ä»¶ï¼š** `app/api/tiktok/publish/init/route.ts`

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥ç”¨æˆ· TikTok ç»‘å®šçŠ¶æ€
- éªŒè¯è§†é¢‘å­˜åœ¨æ€§å’Œæ‰€æœ‰æƒ
- ä» Supabase Storage è·å–è§†é¢‘ URL
- ä¸‹è½½è§†é¢‘åˆ°æœåŠ¡å™¨å†…å­˜/ä¸´æ—¶æ–‡ä»¶
- è®¡ç®—åˆ†å—å‚æ•°
- è°ƒç”¨ TikTok `/v2/post/publish/video/init/` API
- æ‰§è¡Œåˆ†å—ä¸Šä¼ 
- è¿”å› `publish_id` ç»™å‰ç«¯

**è¯·æ±‚æ ¼å¼ï¼š**
```typescript
POST /api/tiktok/publish/init
{
  historyId: string;
  title: string;
  privacyLevel: 'PUBLIC_TO_EVERYONE' | 'MUTUAL_FOLLOW_FRIENDS' | 'SELF_ONLY';
  disableDuet?: boolean;
  disableComment?: boolean;
  disableStitch?: boolean;
}
```

**å“åº”æ ¼å¼ï¼š**
```typescript
{
  success: boolean;
  publishId?: string;
  error?: string;
}
```

---

**ä»»åŠ¡ 2ï¼š** åˆ›å»ºçŠ¶æ€æŸ¥è¯¢ API

**æ–‡ä»¶ï¼š** `app/api/tiktok/publish/status/route.ts`

**åŠŸèƒ½ï¼š**
- æ¥æ”¶ `publish_id`
- è°ƒç”¨ TikTok `/v2/post/publish/status/fetch/` API
- è¿”å›å½“å‰çŠ¶æ€å’Œ post_idï¼ˆå¦‚æœå®Œæˆï¼‰

**è¯·æ±‚æ ¼å¼ï¼š**
```typescript
GET /api/tiktok/publish/status?publishId=<publish_id>
```

**å“åº”æ ¼å¼ï¼š**
```typescript
{
  success: boolean;
  status: 'PROCESSING_UPLOAD' | 'SEND_TO_USER_INBOX' | 'PUBLISH_COMPLETE' | 'FAILED';
  postId?: string;
  postUrl?: string;
  error?: string;
}
```

---

**ä»»åŠ¡ 3ï¼š** åˆ›å»ºä¸Šä¼ è¾…åŠ©å‡½æ•°

**æ–‡ä»¶ï¼š** `lib/tiktok-upload-helper.ts`

**åŠŸèƒ½ï¼š**
- `calculateChunks()` - è®¡ç®—åˆ†å—å‚æ•°
- `uploadChunk()` - ä¸Šä¼ å•ä¸ªåˆ†å—
- `uploadVideo()` - å®Œæ•´ä¸Šä¼ æµç¨‹
- `pollPublishStatus()` - è½®è¯¢å‘å¸ƒçŠ¶æ€

---

#### 2. å‰ç«¯ UI å¼€å‘ â³

**ä»»åŠ¡ 1ï¼š** ä¿®æ”¹è§†é¢‘å†å²é¡µé¢

**æ–‡ä»¶ï¼š** `components/pages/HistoryPage.tsx`

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥ TikTok è¿æ¥çŠ¶æ€
- åœ¨æ¯ä¸ªè§†é¢‘å¡ç‰‡æ·»åŠ  "Post to TikTok" æŒ‰é’®
- æŒ‰é’®æ¡ä»¶æ¸²æŸ“ï¼š
  - æœªç»‘å®šï¼šæ˜¾ç¤º "Connect TikTok"ï¼ˆè·³è½¬åˆ° /dashboard/accountï¼‰
  - å·²ç»‘å®š + è§†é¢‘å®Œæˆï¼šæ˜¾ç¤º "Post to TikTok"
  - å‘å¸ƒä¸­ï¼šæ˜¾ç¤º "Posting..." + åŠ è½½åŠ¨ç”»
- ç‚¹å‡»è§¦å‘å‘å¸ƒå¯¹è¯æ¡†

---

**ä»»åŠ¡ 2ï¼š** åˆ›å»ºå‘å¸ƒå¯¹è¯æ¡†ç»„ä»¶

**æ–‡ä»¶ï¼š** `components/TikTokPublishDialog.tsx`

**åŠŸèƒ½ï¼š**
- è§†é¢‘æ ‡é¢˜è¾“å…¥æ¡†
- éšç§çº§åˆ«é€‰æ‹©å™¨ï¼ˆå•é€‰ï¼‰
- é«˜çº§é€‰é¡¹ï¼ˆå¤é€‰æ¡†ï¼‰ï¼š
  - Disable Duet
  - Disable Comment
  - Disable Stitch
- è§†é¢‘é¢„è§ˆç¼©ç•¥å›¾
- ç¡®è®¤å’Œå–æ¶ˆæŒ‰é’®
- å®æ—¶çŠ¶æ€æ˜¾ç¤ºï¼š
  - åˆå§‹åŒ–...
  - ä¸Šä¼ ä¸­...
  - å¤„ç†ä¸­...
  - å‘å¸ƒå®Œæˆ âœ“
  - å¤±è´¥ âœ—

---

**ä»»åŠ¡ 3ï¼š** å®ç°å‘å¸ƒæµç¨‹

**æµç¨‹ï¼š**
```
1. ç”¨æˆ·ç‚¹å‡» "Post to TikTok" æŒ‰é’®
   â†“
2. æ‰“å¼€å‘å¸ƒå¯¹è¯æ¡†
   â†“
3. ç”¨æˆ·å¡«å†™æ ‡é¢˜å’Œé€‰é¡¹
   â†“
4. ç‚¹å‡» "Post" ç¡®è®¤
   â†“
5. è°ƒç”¨ /api/tiktok/publish/init
   â†“
6. æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
   â†“
7. è½®è¯¢ /api/tiktok/publish/status (æ¯ 5 ç§’)
   â†“
8. æ˜¾ç¤ºæœ€ç»ˆç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
   â†“
9. å…³é—­å¯¹è¯æ¡†
```

---

#### 3. æ•°æ®åº“æ‰©å±•ï¼ˆå¯é€‰ï¼‰â³

**è¡¨ï¼š** `tiktok_publish_history`

```sql
CREATE TABLE tiktok_publish_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR NOT NULL,
  history_id UUID NOT NULL,              -- å…³è”åˆ° ads projects
  tiktok_publish_id VARCHAR NOT NULL,
  tiktok_post_url TEXT,
  tiktok_post_id VARCHAR,
  status VARCHAR DEFAULT 'processing',
  title TEXT,
  privacy_level VARCHAR,
  created_at TIMESTAMPTZ DEFAULT now(),
  completed_at TIMESTAMPTZ,

  FOREIGN KEY (history_id) REFERENCES standard_ads_projects(id)
);
```

**ç”¨é€”ï¼š**
- è¿½è¸ªå‘å¸ƒå†å²
- æ˜¾ç¤ºå‘å¸ƒè®°å½•
- æ•°æ®åˆ†æ

---

### å½“å‰è¿›åº¦

| ä»»åŠ¡ | çŠ¶æ€ | è¿›åº¦ |
|------|------|------|
| **åç«¯ API** |  |  |
| â”œâ”€ init API | â³ å¾…å®æ–½ | 0% |
| â”œâ”€ status API | â³ å¾…å®æ–½ | 0% |
| â””â”€ è¾…åŠ©å‡½æ•° | â³ å¾…å®æ–½ | 0% |
| **å‰ç«¯ UI** |  |  |
| â”œâ”€ HistoryPage æŒ‰é’® | â³ å¾…å®æ–½ | 0% |
| â”œâ”€ å‘å¸ƒå¯¹è¯æ¡† | â³ å¾…å®æ–½ | 0% |
| â””â”€ çŠ¶æ€è¿½è¸ª | â³ å¾…å®æ–½ | 0% |
| **æ–‡æ¡£** |  |  |
| â”œâ”€ API Guide | âœ… å·²å®Œæˆ | 100% |
| â””â”€ Integration Progress | âœ… å·²å®Œæˆ | 100% |

---

## Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆè§„åˆ’ä¸­ï¼‰

### è®¡åˆ’æ—¶é—´
**æœªæ¥è§„åˆ’** ğŸ“…

### åŠŸèƒ½è§„åˆ’

#### 1. æ‰¹é‡å‘å¸ƒ ğŸ“…

**æè¿°ï¼š** å…è®¸ç”¨æˆ·ä¸€æ¬¡æ€§é€‰æ‹©å¤šä¸ªè§†é¢‘å‘å¸ƒåˆ° TikTok

**åŠŸèƒ½ç‚¹ï¼š**
- å¤šé€‰è§†é¢‘ç•Œé¢
- æ‰¹é‡é…ç½®å‘å¸ƒå‚æ•°
- é˜Ÿåˆ—ç®¡ç†
- è¿›åº¦è¿½è¸ª

**é¢„ä¼°å·¥ä½œé‡ï¼š** 2-3 å¤©

---

#### 2. å®šæ—¶å‘å¸ƒ ğŸ“…

**æè¿°ï¼š** æ”¯æŒé¢„å®šå‘å¸ƒæ—¶é—´

**åŠŸèƒ½ç‚¹ï¼š**
- æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
- å®šæ—¶ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¯èƒ½ä½¿ç”¨ Vercel Cron æˆ–å¤–éƒ¨æœåŠ¡ï¼‰
- å‘å¸ƒæé†’
- å–æ¶ˆ/ä¿®æ”¹åŠŸèƒ½

**é¢„ä¼°å·¥ä½œé‡ï¼š** 3-5 å¤©

**æŠ€æœ¯æŒ‘æˆ˜ï¼š**
- éœ€è¦æŒä¹…åŒ–ä»»åŠ¡é˜Ÿåˆ—
- å¯é çš„è§¦å‘æœºåˆ¶
- æ—¶åŒºå¤„ç†

---

#### 3. è§†é¢‘æ•°æ®åˆ†æ ğŸ“…

**æè¿°ï¼š** åŒæ­¥ TikTok è§†é¢‘è¡¨ç°æ•°æ®åˆ° Flowtra

**åŠŸèƒ½ç‚¹ï¼š**
- è§‚çœ‹æ•°ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°åŒæ­¥
- æ•°æ®å¯è§†åŒ–å›¾è¡¨
- è¶‹åŠ¿åˆ†æ
- å¯¼å‡ºæŠ¥å‘Š

**é¢„ä¼°å·¥ä½œé‡ï¼š** 5-7 å¤©

**æŠ€æœ¯è¦æ±‚ï¼š**
- ä½¿ç”¨ TikTok Video API
- å®šæœŸæ•°æ®åŒæ­¥ï¼ˆCron Jobï¼‰
- æ•°æ®å­˜å‚¨å’Œç´¢å¼•

---

#### 4. å¤šè´¦å·ç®¡ç† ğŸ“…

**æè¿°ï¼š** æ”¯æŒç»‘å®šå’Œç®¡ç†å¤šä¸ª TikTok è´¦å·

**åŠŸèƒ½ç‚¹ï¼š**
- æ·»åŠ /åˆ é™¤å¤šä¸ªè´¦å·
- è´¦å·åˆ‡æ¢
- ä¸ºæ¯ä¸ªè´¦å·ç‹¬ç«‹å‘å¸ƒ
- è´¦å·ç»Ÿè®¡å¯¹æ¯”

**é¢„ä¼°å·¥ä½œé‡ï¼š** 2-3 å¤©

**æ•°æ®åº“ä¿®æ”¹ï¼š**
- ç§»é™¤ `tiktok_open_id` unique çº¦æŸ
- æ·»åŠ  `is_primary` å­—æ®µ
- æ·»åŠ è´¦å·åˆ«å

---

#### 5. è‡ªåŠ¨å‘å¸ƒå·¥ä½œæµ ğŸ“…

**æè¿°ï¼š** è§†é¢‘ç”Ÿæˆå®Œæˆåè‡ªåŠ¨å‘å¸ƒåˆ° TikTok

**åŠŸèƒ½ç‚¹ï¼š**
- è‡ªåŠ¨å‘å¸ƒå¼€å…³
- é¢„è®¾å‘å¸ƒæ¨¡æ¿
- è‡ªåŠ¨æ ‡é¢˜ç”Ÿæˆï¼ˆAIï¼‰
- å‘å¸ƒé€šçŸ¥

**é¢„ä¼°å·¥ä½œé‡ï¼š** 3-4 å¤©

---

## åŠŸèƒ½æ¸…å•

### å·²å®ç°åŠŸèƒ½ âœ…

- [x] TikTok OAuth 2.0 æˆæƒ
- [x] ç”¨æˆ·è´¦å·ç»‘å®š
- [x] Token å®‰å…¨å­˜å‚¨ï¼ˆåŠ å¯†ï¼‰
- [x] ç»‘å®šçŠ¶æ€ç®¡ç† UI
- [x] è´¦å·è§£ç»‘åŠŸèƒ½
- [x] CSRF æ”»å‡»é˜²æŠ¤
- [x] è·¨åŸŸ Cookie å¤„ç†
- [x] Clerk middleware é…ç½®
- [x] å®Œæ•´æŠ€æœ¯æ–‡æ¡£

### å¼€å‘ä¸­åŠŸèƒ½ ğŸ”„

- [ ] è§†é¢‘å‘å¸ƒåˆå§‹åŒ– API
- [ ] åˆ†å—ä¸Šä¼ å®ç°
- [ ] å‘å¸ƒçŠ¶æ€æŸ¥è¯¢ API
- [ ] å‘å¸ƒæŒ‰é’® UI
- [ ] å‘å¸ƒå¯¹è¯æ¡†ç»„ä»¶
- [ ] çŠ¶æ€è½®è¯¢æœºåˆ¶

### è®¡åˆ’ä¸­åŠŸèƒ½ ğŸ“…

- [ ] æ‰¹é‡å‘å¸ƒ
- [ ] å®šæ—¶å‘å¸ƒ
- [ ] æ•°æ®åˆ†æåŒæ­¥
- [ ] å¤šè´¦å·ç®¡ç†
- [ ] è‡ªåŠ¨å‘å¸ƒå·¥ä½œæµ
- [ ] å‘å¸ƒæ¨¡æ¿ç®¡ç†

---

## å·²çŸ¥é—®é¢˜

### å·²è§£å†³ âœ…

1. **Clerk Middleware æ‹¦æˆªå›è°ƒ**
   - çŠ¶æ€ï¼šâœ… å·²è§£å†³
   - è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  `/api/tiktok/auth/callback` åˆ°å…¬å¼€è·¯ç”±
   - æäº¤ï¼š`f9675f7`

2. **Cookie è·¨åŸŸæ— æ³•ä¼ é€’ï¼ˆCSRF state mismatchï¼‰**
   - çŠ¶æ€ï¼šâœ… å·²è§£å†³
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `sameSite: 'none'` + `secure: true`
   - æäº¤ï¼š`f9675f7`

### å¾…è§£å†³ âš ï¸

1. **Token è‡ªåŠ¨åˆ·æ–°**
   - çŠ¶æ€ï¼šâš ï¸ æœªå®ç°
   - å½±å“ï¼šToken è¿‡æœŸåéœ€è¦ç”¨æˆ·æ‰‹åŠ¨é‡æ–°æˆæƒ
   - ä¼˜å…ˆçº§ï¼šä¸­
   - è®¡åˆ’ï¼šPhase 2 æˆ– Phase 3

2. **å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½**
   - çŠ¶æ€ï¼šâš ï¸ å¾…æµ‹è¯•
   - å½±å“ï¼šè¶…å¤§è§†é¢‘ï¼ˆ>500MBï¼‰ä¸Šä¼ å¯èƒ½ä¸ç¨³å®š
   - ä¼˜å…ˆçº§ï¼šä½
   - è®¡åˆ’ï¼šPhase 3 ä¼˜åŒ–

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2 å‘¨ï¼‰

1. âœ… å®Œæˆ Phase 2 åç«¯ API å¼€å‘
   - init ç«¯ç‚¹
   - status ç«¯ç‚¹
   - ä¸Šä¼ è¾…åŠ©å‡½æ•°

2. âœ… å®Œæˆ Phase 2 å‰ç«¯ UI å¼€å‘
   - HistoryPage é›†æˆ
   - å‘å¸ƒå¯¹è¯æ¡†
   - çŠ¶æ€è¿½è¸ª

3. âœ… æµ‹è¯•å’Œä¼˜åŒ–
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - ç”¨æˆ·éªŒæ”¶æµ‹è¯•

### ä¸­æœŸç›®æ ‡ï¼ˆ1 ä¸ªæœˆï¼‰

1. ğŸ“… å®ç° Token è‡ªåŠ¨åˆ·æ–°
2. ğŸ“… æ·»åŠ å‘å¸ƒå†å²è¿½è¸ª
3. ğŸ“… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
4. ğŸ“… æ”¶é›†ç”¨æˆ·åé¦ˆ

### é•¿æœŸç›®æ ‡ï¼ˆ3-6 ä¸ªæœˆï¼‰

1. ğŸ“… å®ç° Phase 3 é«˜çº§åŠŸèƒ½
2. ğŸ“… æ•°æ®åˆ†æé›†æˆ
3. ğŸ“… å¤šè´¦å·ç®¡ç†
4. ğŸ“… è‡ªåŠ¨åŒ–å·¥ä½œæµ

---

## è´¡çŒ®è€…

- **å¼€å‘å›¢é˜Ÿï¼š** Flowtra Development Team
- **ä¸»è¦å¼€å‘è€…ï¼š** Claude Code Assistant
- **é¡¹ç›®è´Ÿè´£äººï¼š** lantianlaoli@gmail.com

---

## æ›´æ–°æ—¥å¿—

### 2025-01-28
- âœ… å®Œæˆ Phase 1ï¼ˆè´¦å·ç»‘å®šï¼‰
- âœ… åˆ›å»ºé›†æˆè¿›åº¦æ–‡æ¡£
- âœ… åˆ›å»º Content Posting API æŠ€æœ¯æ–‡æ¡£
- ğŸ”„ å¯åŠ¨ Phase 2ï¼ˆå†…å®¹å‘å¸ƒï¼‰

---

**æœ€åæ›´æ–°ï¼š** 2025-01-28
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
**è”ç³»æ–¹å¼ï¼š** lantianlaoli@gmail.com
